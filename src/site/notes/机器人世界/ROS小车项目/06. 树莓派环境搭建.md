---
{"dg-publish":true,"permalink":"/机器人世界/ROS小车项目/06. 树莓派环境搭建/"}
---


# 镜像烧录

基于Mac进行树莓派的镜像烧录，选择Server版本（开发通过远程桌面和SSH），烧录+开发无需键盘、显示器。

+ 安装[https://www.raspberrypi.com/software/](https://www.raspberrypi.com/software/)
+ 点击 **Choose OS** → **Other general-purpose OS** → **Ubuntu**
+ 选择：**Ubuntu Server 24.04 LTS (64-bit)**（Raspberry Pi 专用）
+ 连接树莓派设备
+ 配置WIFI（要和电脑处于同一WIFI网络便于SSH）、用户名、密码
+ 烧录
+ 使用LanScan（APP Store）扫描获取树莓派的IP，ssh进入

# 国内镜像源

参考 https://comate.baidu.com/zh/page/srm3pivjdua.
```sh
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
sudo nano /etc/apt/sources.list
```
+ 修改为以下源
```
deb http://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-security main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-security main restricted universe multiverse
```
+ 更新软件包列表和系统
```sh
sudo apt update
sudo apt upgrade -y
```


# ROS2 安装

参考 https://docs.ros.org/en/jazzy/Installation/Ubuntu-Install-Debs.html
https://blog.csdn.net/qq_39161894/article/details/150589926

```sh
locale
sudo apt update && sudo apt install locales
sudo locale-gen en_US en_US.UTF-8
sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8
export LANG=en_US.UTF-8
locale
```

```sh
sudo apt install -y curl gnupg2 lsb-release software-properties-common
sudo add-apt-repository universe

# 如果下载失败, 可以笔记本电脑访问文件然后导入到树莓派里
curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/ros.gpg

sudo sh -c 'echo "deb [arch=arm64 signed-by=/etc/apt/trusted.gpg.d/ros.gpg] https://mirrors.tuna.tsinghua.edu.cn/ros2/ubuntu noble main" > /etc/apt/sources.list.d/ros2.list'

export ROS_APT_SOURCE_VERSION=$(curl -s https://api.github.com/repos/ros-infrastructure/ros-apt-source/releases/latest | grep -F "tag_name" | awk -F\" '{print $4}')

curl -L -o /tmp/ros2-apt-source.deb "https://github.com/ros-infrastructure/ros-apt-source/releases/download/${ROS_APT_SOURCE_VERSION}/ros2-apt-source_${ROS_APT_SOURCE_VERSION}.$(. /etc/os-release && echo $VERSION_CODENAME)_all.deb"

sudo dpkg -i /tmp/ros2-apt-source.deb
sudo apt update && sudo apt install ros-dev-tools
sudo apt update
sudo apt upgrade

```

最后安装ros。
```sh
sudo apt install -y ros-jazzy-ros-base

# 如果报错一些依赖没有
sudo apt --fix-broken install -y
```

报错一些依赖版本不匹配问题，需要进行降级。
```sh
sudo apt install -y libzstd1=1.5.5+dfsg2-2build1 --allow-downgrades --allow-change-held-packages
sudo apt install -y libuuid1=2.39.3-9ubuntu6 --allow-downgrades --allow-change-held-packages
sudo apt install -y ros-jazzy-tracetools:arm64 ros-jazzy-rmw-fastrtps-cpp:arm64
sudo apt install -y ros-jazzy-ros-base:arm64
```
安装完ROS2后，仿照[[机器人世界/ROS小车项目/02. MAC安装ROS#^bc97c9\|02. MAC安装ROS#^bc97c9]]，添加：
```sh
source /opt/ros/jazzy/setup.bash
```

恢复依赖的版本。
```sh
sudo apt-mark unhold libuuid1
sudo apt upgrade -y libuuid1
sudo apt-mark unhold libzstd1
sudo apt upgrade -y libzstd1
```

# 树莓派配置

## 网络配置

+ 查看WIFI网络配置。
```sh
sudo cat /etc/netplan/50-cloud-init.yaml
```
+ 修改（新增）WIFI"28号302"
```sh
sudo cp /etc/netplan/50-cloud-init.yaml /etc/netplan/50-cloud-init.yaml.bk
sudo nano /etc/netplan/50-cloud-init.yaml
```
```
network:
  version: 2
  ethernets:
    eth0:
      optional: true
      dhcp4: true
      dhcp6: true
  wifis:
    wlan0:
      optional: true
      dhcp4: true
      regulatory-domain: "CN"
      access-points:
        "lxq":
          auth:
            key-management: "psk"
            password: "7a37532a89f100b740f8f875f7b9f2b1477ecd80114e34daf20407629ff579ec"
        "28号302":
          auth:
            key-management: "psk"
            password: "jiangyibo1985727"
```
+ 应用修改
```sh
# 先验证配置文件语法是否正确（重要！避免配置错误）
sudo netplan try
# 验证无误后，应用配置
sudo netplan apply
```

## 风扇温控

+ 查看芯片当前温度
```sh
vcgencmd measure_temp
```
+ 