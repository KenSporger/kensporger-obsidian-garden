---
{"dg-publish":true,"permalink":"/机器人世界/ROS小车项目/02. MAC安装ROS/"}
---


# 安装方式对比

|安装方式|适配性（M1/macOS 14.5）|难度|优点|缺点|
|---|---|---|---|---|
|Docker（ARM 镜像）|✅ 完美适配|低|环境隔离、一键运行、无系统依赖冲突|图形工具（RViz 2）需额外配置显示|
|Homebrew 安装|✅ 适配（需手动解决部分依赖）|中|原生运行、性能好|依赖易出问题、部分工具（如 Gazebo）兼容差|
|源码编译|✅ 适配（需调整编译参数）|高|高度自定义|步骤繁琐、编译耗时、排错成本高|

# docker安装

+ 下载地址：[https://www.docker.com/products/docker-desktop/](https://www.docker.com/products/docker-desktop/)
+ 配置镜像加速，Docker Desktop → `Settings` → `Docker Engine`（配置了似乎报错，反正最后开VPN了）
```json
{ "registry-mirrors": [ "https://docker.mirrors.ustc.edu.cn", "https://hub-mirror.c.163.com" ], "experimental": false, "features": { "buildkit": true } }
```

#  安装ROS2

https://github.com/tatsuyai713/Development-Container-for-ROS2-on-Arm64-Mac
按照REAME里的步骤操作到`./start_container.sh`。

## attach端口占用
执行`attach_container.sh`报错：
```
Error response from daemon: ports are not available: exposing port TCP 0.0.0.0:9090 -> 127.0.0.1:0: listen tcp 0.0.0.0:9090: bind: address already in use
failed to start containers: c0f2c2ec9ee9
Error response from daemon: container c0f2c2ec9ee9a297b5ed6915539b016750b96d97175d590dab61ec145b4dcc68 is not running
```
原因是9090端口已经被系统其他进程占用了，需要修改`launch_container.sh`里的配置如下（改了似乎不生效，通过`lsof -i :9090`看到是clashX在占用，退出就好了）：
```sh
DOCKER_OPT="${DOCKER_OPT} \
                --volume=/Users/${USER}:/home/${USER}/host_home:rw \
                --shm-size=4gb \
                --env=TERM=xterm-256color \
                -w ${DOCKER_WORK_DIR} \
                -u ${USER} \
                --ipc=host \
                --hostname Docker-$(hostname) \
                --add-host Docker-$(hostname):127.0.1.1 \
                -p 3389:3389 \
                -p 8765:8765 \
                -p 8080:9090 \
                -e PASSWD=${USER}"
```



## 远程桌面访问
前提是`attach_container.sh`执行成功。APP Store里安装Microsoft Remote Desktop。
![Pasted image 20260209173655.png](/img/user/%E6%9C%BA%E5%99%A8%E4%BA%BA%E4%B8%96%E7%95%8C/ROS%E5%B0%8F%E8%BD%A6%E9%A1%B9%E7%9B%AE/img/Pasted%20image%2020260209173655.png)

双击创建的设备，就可以进入连接，密码就是用户名（命令行看是什么用户名）。

# 使用官方ROS2镜像（废弃）
## 拉取ros镜像（废弃）

+ 输入`docker search osrf/ros`（需要开代理），查看docker支持的ros镜像列表。

```
NAME                                            DESCRIPTION                                      STARS     OFFICIAL
osrf/ros                                        The Robot Operating System (ROS) is an open …   201       
osrf/ubuntu_armhf                               Ubuntu ARMhf images                              6         
osrf/ubuntu_arm64                               Ubuntu Arm64 Base Images                         2         
osrf/ubuntu_i386                                Ubuntu i386 Docker Base Images                   2         
osrf/debian_arm64                               Debian arm64 Base Images                         1         
osrf/ubuntu_32bit                               Deprecated please use https://hub.docker.com…   2         
osrf/ros2                                       **Experimental** Docker Images for ROS2 deve…   86        
osrf/ros_legacy                                 Legacy docker image archive for Robot Operat…   3         
osrf/space-ros                                  Docker images for the Space ROS project http…   5         
osrf/subt-virtual-testbed                       Docker images that run the SubT Virtual Test…   3         
osrf/space-ros-nav2                                                                              0         
osrf/gazebo                                     **DEPRECATED** Official images at https://hu…   9         
osrf/space-ros-moveit2                                                                           0         
osrf/debian_armhf                               Debian Armhf Base Images                         1         
osrf/vrx                                        Virtual RobotX (VRX) Docker images.              0         
osrf/mbzirc                                     Docker images for the MBZIRC Maritime Grand …   0         
osrf/sros                                       Experimental Images of SROS                      1         
osrf/icra2023_ros2_gz_tutorial                  Docker image for the ICRA London tutorial on…   3         
osrf/vmrc                                       Virtual Maritime RobotX Challenge (VMRC) Doc…   0         
osrf/car_demo                                                                                    0         
osrf/ros2_packaging_aarch64_jammy_39_snapshot                                                    2         
osrf/trusty-ros-indigo                                                                           0         
osrf/lrauv                                                                                       0         
osrf/ros2_batch_ci_aarch64_jammy_39_snapshot                                                     0         
osrf/ros2_batch_ci_jammy_39_snapshot                                                             0 
```
+ 这里面暂时没有Jazzy版本，所以选择Humble版本 `docker pull --platform linux/arm64/v8 osrf/ros:humble-desktop-full`。
```
humble-desktop-full: Pulling from osrf/ros
72dabda1f44b: Pull complete 
d7e9ae4043d8: Pull complete 
d89d0b0792ec: Pull complete 
5b3b6a798b50: Pull complete 
3f147c465ef3: Pull complete 
3c1550f451c4: Pull complete 
6b0d10a978db: Pull complete 
5a1e1824e50f: Pull complete 
6f4ebca3e823: Pull complete 
f3c9c540e89d: Pull complete 
58aaf05f7e47: Pull complete 
ecd839ce83db: Pull complete 
Digest: sha256:d54eecdb999d4386939f87129f0946d01b6e121fc8d291666c4c7562bf2fe640
Status: Downloaded newer image for osrf/ros:humble-desktop-full
docker.io/osrf/ros:humble-desktop-full
```

## 运行ROS镜像（废弃）

```
docker run -it --name ros2-humble-m1 --privileged -v ~/Documents/code/robot/ros2:/root/ros2 osrf/ros:humble-desktop-full
```

发现报错：
```
WARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested
```
原因是官网并未提供arm64版本。删除镜像
```
docker stop ros2-humble-m1
docker rm ros2-humble-m1
docker image
docker rmi d54eecdb999d
```




# 安装ROS1

同样使用Github上的脚本 https://github.com/StefanoHernandez/ros1-arm64
输入以下命令进行构建（如果下载失败重新敲就行，多次重试后就能下载成功了）：
```sh
docker build -t ros_noetic_amd64 .
```

然后运行镜像，这里我在`Makefile`里增加了一个`robot`目录用来映射到电脑里的代码目录。
```sh
docker run -it --rm -e DISPLAY=host.docker.internal:0 -v ~/Documents/code/robot:/home/ros/catkin_ws/robot ros_noetic_amd64

```

执行以下命令可以进入镜像的命令行。
```sh
docker exec -it 7c584558d2af /bin/bash
```

# 快捷操作

## 使用Item2终端分屏

[官网](https://iterm2.com/)下载Item2，支持快捷键分屏。

|功能分类|快捷键|说明|
|---|---|---|
|新建标签页|command + t|新建 Tab|
|分屏|command + d / command + shift + d|左右 / 上下分屏|
|切换分屏|command + ] / [|在分屏之间切换|
|关闭分屏|command + w|关闭当前分屏或标签|
|切换标签|command + 数字 / control + tab|快速切换|
|新建窗口|command + n|打开新窗口|
|切换窗口|command + \/command + shift + “|上下窗口切换|

## 简化docket运行命令

修改`~/.zshrc`，这样在每次新开命令行可以通过简化的命令快速进入docker。
```sh
alias run_ros1="docker run -it --rm -e DISPLAY=host.docker.internal:0 --name ros_noetic_container -v ~/Documents/code/robot:/home/ros/catkin_ws/robot ros_noetic_amd64"
alias ros1="docker exec -it ros_noetic_container /bin/bash"
alias run_ros2="/Users/lxq/Documents/code/robot/Development-Container-for-ROS2-on-Arm64-Mac-24.04/start_container.sh"
alias ros2="/Users/lxq/Documents/code/robot/Development-Container-for-ROS2-on-Arm64-Mac-24.04/attach_container.sh"
```


## 简化功能包setup

在docker里的命令行输入以下命令，如果有多个公共空间，都可以加入（避免重名就行）。

```sh
echo "source /home/ros/catkin_ws/robot/ros_21/devel/setup.bash" >> /home/ros/.bashrc
```
{ #bc97c9}

